# 開発フェーズ・ロードマップ

## 基本方針

自社事業所内での実務運用を最優先（P0/P1）とし、それ以外は環境変数で隠蔽または後回しにする。

---

## フェーズ1: 実務必須機能（優先度 P0-P1）

**目標**: 本番環境で最初に開放し、自社運営で即座に使用する機能群

### 施設情報（facility）
- 営業日、定員、取得加算のマスタ管理
- サービス種別（児発/放デイ/多機能）の設定
- 地域区分の設定
- 時間枠（facility_time_slots）の設定

### スタッフ管理（staff）& シフト管理（shift）
- 雇用記録（employment_records）の管理
- 月間シフト作成（人員配置基準の根拠となるため最優先）
- スタッフの招待・アクティベーションフロー
- 勤怠打刻（出退勤ボタン）
- 有給休暇の申請・承認フロー
- 勤務実績表（出勤簿）の出力

### 児童管理（children）
- 基本情報、受給者証情報、契約情報
- 保護者アカウントとの紐付け
- 契約管理（contracts テーブル経由）

### 利用調整・予約（schedule）
- 日々の利用スロット（AM/PM等）の割り当て
- 週間/月間カレンダー表示
- 予約管理、承認待ちリクエスト処理

### 業務日誌（daily-log）
- 実績入力（来所・退所、加算選択、バイタル、活動記録）
- 連絡帳の作成

### ダッシュボード（dashboard）
- 今日の予約数
- 簡易的なKPI表示
- 稼働率表示（時間枠・定員設定に依存）

### 個別支援計画（support-plan）
- 作成・管理（まずはPDFアップロード等の簡易版でも可）
- 5領域（健康・生活、運動・感覚、認知・行動、言語・コミュニケーション、人間関係・社会性）への対応

### 基本書類出力
- Wordテンプレートからの自動生成
  - ヒヤリハット報告書
  - 事故報告書
  - 契約同意書

---

## フェーズ2: 請求・監査・経営（優先度 P2）

**目標**: 開発は進めるが、本番では環境変数 `ENABLE_BETA` が true の場合のみ表示

### 指定申請・変更届出力
- 複雑なExcel（新規指定様式 R07版）へのデータ流し込み
- 3つの戦略: マスタ注入、直接書き込み、シートの動的選別
- 勤務体制一覧表の自動生成（最重要書類）
- 経歴書・実務経験証明書の出力

### 監査準備（audit）
- 行政指導用チェックリスト
- 書類整理機能
- Time Travel機能（過去の特定日の状態再現）

### 経営設定（management）
- 加算分析・シミュレーション
  - 目標単価シミュレーター
  - テンプレート児童での試算
- 売上予測（単価 x 想定児童数）
- 損益計算書
- キャッシュフロー管理
- 経費管理

### 各種記録
- 研修記録の管理
- 委員会管理（虐待防止委員会、身体拘束廃止委員会等）
- BCP研修・訓練記録

### 加算ライフサイクル管理
- Planned → Applying → Active → Inactive のステータス管理
- 15日締切のアラート機能
- 変更届の自動生成

---

## フェーズ3: 外部連携・SaaS化（優先度 P3）

**目標**: 将来的な拡張項目（現在は凍結）

### 保護者アプリ（Client側）
- 欠席連絡
- 予約申し込み
- チャット機能
- 支援記録の閲覧
- バイタル・健康状態の入力
- 施設検索・利用申請

### 送迎ルート（transport）
- ルート最適化
- 乗車位置マップ
- 送迎完了記録

### コネクト
- 複数施設間連携
- リード（問い合わせ）管理
- 施設紹介ネットワーク

### キャリアプラットフォーム拡張
- 実務経験証明のデジタルワークフロー
- キャリアポートフォリオ
- 資格情報の管理
- 施設間での人材マッチング

---

## MVPの3つのコアアカウント構成

### 1. 施設管理者アカウント（Roots for Facility）
- 施設情報の登録
- スタッフの招待と紐付け
- 保護者アカウントの招待と児童情報の紐付け
- シフト作成と勤怠確認・修正
- 有給休暇の承認
- 勤務実績表の出力

### 2. スタッフ/キャリアアカウント（Roots for Career）
- プロフィールと保有資格の登録
- スマホからの出退勤打刻（GPS/QR）
- シフト確認と有給休暇の申請
- 打刻データは個人の実務経験ログとして蓄積

### 3. 保護者アカウント（Roots for Family）
- 児童プロフィール、特性、受給者証データの登録
- 施設との連絡機能
- 複数施設に紐付け可能（バイラルエンジン）

---

## データベース設計の絶対ルール

- **Usersテーブル**: Role（管理者/スタッフ/保護者）を持たせる
- **Facilitiesテーブル**: 施設情報
- **Childrenテーブル**: 保護者（User）に紐づく。施設と中間テーブル（contracts）で紐づく
- **Staff_Profilesテーブル**: スタッフ（User）に紐づく資格・経歴
- **Attendancesテーブル**: 誰が・どこで・いつ働いたかを記録（施設側の監査データ兼スタッフの実務経験データ）

---

## システム移行計画

### Phase 1: データモデル修正
1. `facility_settings` のデフォルト値を削除
2. `staff` テーブルの使用を非推奨化
3. `employment_records` 経由のフローに統一

### Phase 2: UI修正
1. スタッフ「新規追加」→「招待」に変更
2. 加算シミュレーション → 目標単価シミュレーターに変更
3. 未設定時のガイダンス表示を徹底

### Phase 3: 新機能追加
1. 経費・P/L管理
2. 目標単価シミュレーター
3. 計画 vs 実績比較

---

## フィーチャーフラグ管理

```env
# Phase 2機能の表示制御
ENABLE_BETA=true

# Phase 3機能の表示制御（現在は凍結）
ENABLE_CLIENT_APP=false
ENABLE_TRANSPORT=false
ENABLE_CONNECT=false
```

---

*最終更新: 2026-02-25*
