project_analysis:
  description: >
    kidos プロジェクト（{project_root}）の現状を分析してください。

    以下を実行してください:
    1. プロジェクトのディレクトリ構造を確認（src/, supabase/, docs/）
    2. package.json で依存関係とスクリプトを確認
    3. .env.local の設定を確認（APIキーは除く）
    4. 最近のgitコミット履歴を確認
    5. 現在のフェーズ設定（NEXT_PUBLIC_FEATURE_PHASE）を確認

    現在のフェーズ: {current_phase}
    フォーカスエリア: {focus_area}
  expected_output: >
    プロジェクト現状レポート:
    - ディレクトリ構成サマリー
    - 使用技術・ライブラリ一覧
    - 現在のフェーズと有効な機能
    - 最近の開発活動（直近コミットの傾向）
    - 即座に対処すべき問題のリスト
  agent: project_manager

code_audit:
  description: >
    kidos プロジェクト（{project_root}）のコード品質監査を実施してください。

    フロントエンドの観点から:
    1. src/components/ の主要コンポーネントの構造を確認
    2. src/hooks/ のカスタムフックの品質（useFacilityData.ts は2633行、分割が必要か）
    3. src/types/index.ts の型定義の整合性
    4. src/contexts/AuthContext.tsx の認証フローの安全性
    5. コンポーネント間の依存関係と再利用性

    バックエンドの観点から:
    1. src/app/api/ のAPIルートの実装状態
    2. SQLマイグレーションファイルの整合性
    3. Supabase クエリパターンの統一性
    4. src/lib/supabase.ts のクライアント設定

    特に注意すべき点:
    - マスターデータ（facility_settings, facility_time_slots）が未設定の場合の処理
    - staff テーブルと users テーブルの使い分け
    - エラーハンドリングの統一性
  expected_output: >
    コード品質監査レポート:
    - コード構造の問題点
    - リファクタリング推奨箇所
    - セキュリティ上の懸念
    - パフォーマンス改善の余地
    - 技術的負債のリスト（優先度付き）
  agent: frontend_developer

spec_verification:
  description: >
    kidos プロジェクト（{project_root}）の仕様書と実装の整合性を検証してください。

    以下のドキュメントと実装を照合:
    1. REVIEW_PLAN.md の R1〜R7 各フェーズの要件 → 実装状況
    2. SYSTEM_DESIGN.md のデータモデル → 実際のTypeScript型定義
    3. shiyou.md の仕様 → src/app/ のページ実装
    4. phase.md のフェーズ定義 → NEXT_PUBLIC_FEATURE_PHASE の制御

    チェック項目:
    - Phase 1 に含まれるべき全機能が実装されているか
    - Phase 2-3 の機能が Phase 1 に混入していないか
    - REVIEW_PLAN.md の28機能のうち、マスターデータ依存が正しく実装されているもの/されていないもの
    - ドキュメントに記載があるが実装されていない機能のリスト
  expected_output: >
    仕様検証レポート:
    - 仕様と実装の一致率
    - 未実装機能リスト（優先度付き）
    - 仕様超過（仕様にない実装）リスト
    - マスターデータ依存の実装状況マトリクス
    - 推奨アクションリスト
  agent: manual_checker

compliance_review:
  description: >
    kidos プロジェクト（{project_root}）が障害児通所支援事業の法規制に準拠しているか検証してください。

    検証対象:
    1. 人員配置基準の管理機能
       - 児童発達支援管理責任者（児発管）の配置チェック
       - 児童指導員/保育士の配置基準（10:2ルール）
       - 常勤専従/常勤兼務/非常勤の区分管理
    2. 加算システムの実装
       - 加算の取得要件チェック機能（src/utils/additionJudgment.ts）
       - 加算ライフサイクル管理（計画→申請→有効→無効）
       - 届出期限管理（毎月15日）
    3. 減算リスクの検出
       - 未公表減算の防止機能
       - 定員超過減算の検出
       - 人員欠如減算の検出
    4. 帳票出力の法定要件
       - 勤務体制一覧表
       - 実績記録表
       - 利用者一覧表

    参考文書: hohou.md, syougai_manual.md, regulatory_compliance_design.md
  expected_output: >
    法規制コンプライアンスレポート:
    - 準拠している要件のリスト
    - 未対応の法的要件のリスト（リスク度付き）
    - 減算リスクの一覧と対策案
    - 加算システムの改善提案
    - 帳票出力の充足度
    - 緊急対応が必要な項目
  agent: compliance_officer

design_consistency_check:
  description: >
    kidos プロジェクト（{project_root}）のUI/UXデザインの一貫性を検証してください。

    検証項目:
    1. Tailwind CSS クラスの統一性
       - プライマリカラー（#00c4cc / teal系）の使用一貫性
       - ボタンスタイルの統一（サイズ、角丸、ホバー効果）
       - フォームコンポーネントのスタイル統一
    2. コンポーネントデザインパターン
       - カード、モーダル、ドロワーの統一性
       - テーブル/リスト表示の統一性
       - ナビゲーション（Sidebar, Header）の一貫性
    3. レスポンシブ対応
       - モバイル/タブレット/デスクトップの対応状況
       - ブレークポイントの統一使用
    4. アクセシビリティ
       - aria-label の使用状況
       - キーボードナビゲーション対応
       - コントラスト比の適切性

    特に src/components/ 配下の主要コンポーネントを中心に検証。
  expected_output: >
    デザイン一貫性レポート:
    - デザインパターンの統一度スコア
    - 不統一な箇所のリスト
    - レスポンシブ対応の状況
    - アクセシビリティの改善点
    - デザインシステム構築の提案
  agent: design_reviewer

build_verification:
  description: >
    kidos プロジェクト（{project_root}）のビルドと型チェックを実行してください。

    実施項目:
    1. `npx tsc --noEmit` でTypeScriptの型チェック
    2. `npm run build` でNext.jsのビルド検証
    3. ビルドエラーの分析と分類
    4. git status で未コミットの変更を確認

    エラーが発見された場合:
    - エラーの種類別に分類（型エラー、インポートエラー、実行時エラー）
    - 影響範囲の特定
    - 修正の優先度付け
  expected_output: >
    ビルド検証レポート:
    - TypeScript型チェック結果（エラー数、警告数）
    - ビルド成否と所要時間
    - エラーリスト（ファイルパス、行番号、エラー内容）
    - エラーの分類と優先度
    - 推奨修正手順
  agent: qa_engineer

synthesis_report:
  description: >
    これまでの全チームメンバーのレポートを統合し、
    プロジェクトの総合評価と次のアクションプランを作成してください。

    統合すべきレポート:
    1. プロジェクト現状分析（PM）
    2. コード品質監査（フロントエンド/バックエンド）
    3. 仕様検証（マニュアルチェッカー）
    4. 法規制コンプライアンス（コンプライアンス担当）
    5. デザイン一貫性（デザインレビュアー）
    6. ビルド検証（QA）

    以下を含むアクションプランを作成:
    - 今すぐ対応すべき緊急課題 (P0)
    - 1週間以内に対応すべき重要課題 (P1)
    - 1ヶ月以内に対応すべき課題 (P2)
    - 長期的に取り組むべき改善 (P3)

    代表とCTOに報告するための、簡潔で実用的なレポートを作成してください。
    日本語で記述してください。
  expected_output: >
    # Roots プロジェクト総合レポート

    ## エグゼクティブサマリー
    （3-5行のプロジェクト総合評価）

    ## 各領域の評価
    - コード品質: [A/B/C/D]
    - 仕様準拠度: [A/B/C/D]
    - 法規制対応: [A/B/C/D]
    - デザイン品質: [A/B/C/D]
    - ビルド健全性: [A/B/C/D]

    ## 緊急課題 (P0)
    （箇条書き）

    ## 重要課題 (P1)
    （箇条書き）

    ## 中期課題 (P2)
    （箇条書き）

    ## 長期改善 (P3)
    （箇条書き）

    ## 推奨アクションプラン
    （具体的な実施手順）

    markdown形式、日本語で出力。
  agent: project_manager
  output_file: report.md
